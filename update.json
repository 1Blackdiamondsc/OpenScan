[{"id":"77771f03.9ac2f","type":"tab","label":"RPi Cam","disabled":false,"info":""},{"id":"f15aaf51.f4429","type":"ui_base","z":"","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"OpenScan v2 - 2019-09-06","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":6,"py":6}}},{"id":"6fa0c1f6.e5f46","type":"ui_tab","z":"","name":"Page1","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"1c848b66.40e7d5","type":"ui_tab","z":"","name":"Page2","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"b5ac31f2.e5546","type":"ui_spacer","name":"spacer","group":"","order":8,"width":8,"height":1},{"id":"6d395bc6.9a1224","type":"ui_spacer","name":"spacer","group":"","order":2,"width":1,"height":1},{"id":"39e611c3.ac492e","type":"ui_spacer","name":"spacer","group":"","order":4,"width":1,"height":1},{"id":"ec574971.23fad8","type":"ui_spacer","name":"spacer","group":"","order":5,"width":6,"height":1},{"id":"3c0a71d4.3a7c8e","type":"ui_spacer","name":"spacer","group":"","order":6,"width":1,"height":1},{"id":"be9754dd.d57158","type":"ui_spacer","name":"spacer","group":"","order":8,"width":1,"height":1},{"id":"e8b912d4.60346","type":"ui_spacer","name":"spacer","group":"","order":9,"width":1,"height":1},{"id":"37c74ab.a0b69b6","type":"ui_spacer","name":"spacer","group":"","order":11,"width":1,"height":1},{"id":"629d1513.4d6ffc","type":"ui_spacer","name":"spacer","group":"","order":11,"width":8,"height":1},{"id":"1b88f8f5.b7ca47","type":"ui_group","z":"","name":"Setup","tab":"221fad46.1fbc62","order":1,"disp":true,"width":8,"collapse":false},{"id":"9b37fbc4.a91d58","type":"ui_tab","z":"77771f03.9ac2f","name":"RPi Camera","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"221fad46.1fbc62","type":"ui_tab","z":"","name":"Smartphone","icon":"dashboard","order":2,"disabled":true,"hidden":true},{"id":"8219bc76.e1531","type":"ui_tab","z":"","name":"External Camera","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"cc07ead8.374fa8","type":"ui_tab","z":"","name":"System","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"b02275fc.c7e658","type":"ui_group","z":"","name":"Position Setup","tab":"8219bc76.e1531","order":1,"disp":true,"width":"6","collapse":false},{"id":"298946ac.30461a","type":"ui_group","z":"","name":"Group 1","tab":"cc07ead8.374fa8","order":1,"disp":false,"width":"6","collapse":false},{"id":"c70756bd.914b08","type":"ui_spacer","name":"spacer","group":"","order":11,"width":8,"height":1},{"id":"69725b10.8f0674","type":"ui_group","z":"","name":"RPi Control","tab":"9b37fbc4.a91d58","order":1,"disp":true,"width":"6","collapse":false},{"id":"b0cb603d.cba9f","type":"ui_group","z":"","name":"Preview","tab":"9b37fbc4.a91d58","order":2,"disp":true,"width":"12","collapse":false},{"id":"18d58d83.c0def2","type":"ui_group","z":"","name":"Run Routine","tab":"9b37fbc4.a91d58","order":3,"disp":true,"width":"6","collapse":false},{"id":"52e855b.5b4b4ac","type":"ui_spacer","name":"spacer","group":"1b88f8f5.b7ca47","order":8,"width":8,"height":1},{"id":"827e393f.87fff8","type":"ui_group","z":"","name":"Routine Settings","tab":"8219bc76.e1531","order":2,"disp":true,"width":"6","collapse":false},{"id":"a8c1005f.7b3e6","type":"ui_group","z":"","name":"Camera Settings","tab":"8219bc76.e1531","order":3,"disp":true,"width":"6","collapse":false},{"id":"c09ac9d4.8b30b8","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"d1f81b73.75d5a8","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"66a2d2f0.196ebc","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"9d4a6c54.84b28","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"c077a277.7e4a9","type":"ui_spacer","name":"spacer","group":"298946ac.30461a","order":4,"width":6,"height":1},{"id":"3330a8dc.e75ff8","type":"ui_spacer","name":"spacer","group":"298946ac.30461a","order":7,"width":6,"height":1},{"id":"d1b34e46.16c73","type":"ui_group","z":"","name":"Files","tab":"9b37fbc4.a91d58","order":4,"disp":true,"width":"6","collapse":false},{"id":"f266f021.d868a","type":"ui_spacer","name":"spacer","group":"69725b10.8f0674","order":4,"width":6,"height":1},{"id":"f37607a1.53da18","type":"ui_spacer","name":"spacer","group":"69725b10.8f0674","order":8,"width":6,"height":1},{"id":"8b3bb514.cb4888","type":"ui_spacer","name":"spacer","group":"69725b10.8f0674","order":13,"width":6,"height":1},{"id":"4b23be67.913de","type":"ui_spacer","name":"spacer","group":"69725b10.8f0674","order":16,"width":6,"height":1},{"id":"6565754b.94d6cc","type":"ui_spacer","name":"spacer","group":"a8c1005f.7b3e6","order":5,"width":6,"height":1},{"id":"cb6459ca.79a758","type":"inject","z":"77771f03.9ac2f","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"","x":73.00003051757812,"y":245.00002479553223,"wires":[["4ddb07c8.671dd8","afef5452.f0a2c8","d9dfd477.fe0dc8","3f02bc93.250c74","e2c69aa8.534cb8","39d74681.35e8ca","5bcdc8e6.7dd098","8214b592.a7d398","82ad645b.ad0a68"]]},{"id":"4ddb07c8.671dd8","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/fotosperrotation.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":422.0000228881836,"y":339.00001788139343,"wires":[["eb9f4a2.cba54b8"]]},{"id":"afef5452.f0a2c8","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/verticalpositions.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":421.0000343322754,"y":391.0000114440918,"wires":[["7b16f091.89c1c"]]},{"id":"d9dfd477.fe0dc8","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/startdeflection.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":411.0000457763672,"y":440.0000305175781,"wires":[["926375ec.e3b838"]]},{"id":"3f02bc93.250c74","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/camerabrightness.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":419.0000534057617,"y":488.0000228881836,"wires":[["694110bd.3c57b"]]},{"id":"d75ddc63.2a31e","type":"exec","z":"77771f03.9ac2f","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":505.9804344177246,"y":3325.0002727508545,"wires":[[],[],[]]},{"id":"38015d8.ba825a2","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"18d58d83.c0def2","order":8,"width":0,"height":0,"passthru":true,"label":"Start Routine","tooltip":"","color":"","bgcolor":"","icon":"","payload":"starten","payloadType":"str","topic":"","x":98.00005340576172,"y":1051.0005207061768,"wires":[["7347eb5a.5c4ab4"]]},{"id":"58911119.40d47","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"69725b10.8f0674","order":17,"width":6,"height":1,"passthru":false,"label":"Update Preview","tooltip":"press to show the effect of changed settings (takes one second to load)","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":107.00007247924805,"y":906.0007390975952,"wires":[["826e49c4.c3fa98"]]},{"id":"2feaecea.c7a084","type":"ui_text","z":"77771f03.9ac2f","group":"69725b10.8f0674","order":9,"width":6,"height":1,"name":"","label":"Camera Brightness","format":"{{msg.payload}}","layout":"row-spread","x":1158.0000457763672,"y":488.0000228881836,"wires":[]},{"id":"c98a7d7e.19ebf","type":"exec","z":"77771f03.9ac2f","command":"sudo shutdown -h now","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":535.980411529541,"y":3413.0002765655518,"wires":[[],[],[]]},{"id":"2b318c93.b86104","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"69725b10.8f0674","order":6,"width":2,"height":1,"passthru":false,"label":"⇐","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":452.99999618530273,"y":1182.000340461731,"wires":[["a3913f40.b5af9"]]},{"id":"9fe070a6.615fa","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"69725b10.8f0674","order":7,"width":2,"height":1,"passthru":false,"label":"⇒","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":452.99999618530273,"y":1222.000340461731,"wires":[["d43464a4.91a718"]]},{"id":"5a601fde.09132","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"69725b10.8f0674","order":2,"width":2,"height":1,"passthru":false,"label":"⇑","tooltip":"","color":"","bgcolor":"","icon":"","payload":"500","payloadType":"num","topic":"","x":77.00003814697266,"y":1186.0003514289856,"wires":[["9bf461d9.060f5"]]},{"id":"879a7c84.ad47d","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"69725b10.8f0674","order":3,"width":2,"height":1,"passthru":false,"label":"⇓","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":77.00003814697266,"y":1226.0003514289856,"wires":[["44542c17.e3c924"]]},{"id":"262a6bf8.7aa274","type":"ui_text","z":"77771f03.9ac2f","group":"69725b10.8f0674","order":5,"width":2,"height":1,"name":"","label":"Turntable","format":"{{\"\"}}","layout":"row-center","x":462.99999618530273,"y":1142.000340461731,"wires":[]},{"id":"2597f509.29cd5a","type":"ui_text","z":"77771f03.9ac2f","group":"69725b10.8f0674","order":1,"width":2,"height":1,"name":"","label":"Rotor","format":"{{\"\"}}","layout":"row-center","x":77.00003814697266,"y":1146.0003514289856,"wires":[]},{"id":"a3913f40.b5af9","type":"python3-function","z":"77771f03.9ac2f","name":"TT left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 9   # Direction GPIO Pin\nSTEP = 11  # Step GPIO Pin\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 0)\n\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\n\n\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":586.0000114440918,"y":1183.0003304481506,"wires":[["85914e85.e0468"]]},{"id":"d43464a4.91a718","type":"python3-function","z":"77771f03.9ac2f","name":"TT right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\n\nDIR = 9   # Direction GPIO Pin\nSTEP = 11  # Step GPIO Pin\n\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 1)\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":600,"y":1223.0003972053528,"wires":[["85914e85.e0468"]]},{"id":"9bf461d9.060f5","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 5   # Direction GPIO Pin\nSTEP = 6  # Step GPIO Pin\nSPR = 200   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 0)\n\nstep_count = SPR\ndelay = .0005\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":227.00003814697266,"y":1186.0003514289856,"wires":[["e7d13a45.c91618"]]},{"id":"44542c17.e3c924","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 5   # Direction GPIO Pin\nSTEP = 6  # Step GPIO Pin\nSPR = 200\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 1)\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":237.00003814697266,"y":1226.0003514289856,"wires":[["e7d13a45.c91618"]]},{"id":"7347eb5a.5c4ab4","type":"python3-function","z":"77771f03.9ac2f","name":"Run Routine","func":"import RPi.GPIO as GPIO\nimport time\nimport picamera\nfrom time import sleep\n# Zip-packer\nimport os\nimport shutil\nfrom os import path\nfrom zipfile import ZipFile\nfrom os import path\nfrom shutil import make_archive\n\nfrom PIL import Image\n\n\n#recieve global variables\nwith open(\"/home/pi/shared/log/fotosperrotation.log\", \"r\") as file:\n    fotosperrotation=int(file.read())\nwith open(\"/home/pi/shared/log/startdeflection.log\", \"r\") as file:\n    startdeflection=int(file.read())\nwith open(\"/home/pi/shared/log/verticalpositions.log\", \"r\") as file:\n    verticalpositions=int(file.read())\nwith open(\"/home/pi/shared/log/projectname.log\", \"r\") as file:\n    projectname=file.read()\n\n#set some fixed parameters\ncamerawidth= 1\ncameraheight= 1\nresx=int(3280)\nresy=int(2464)\nphotopin=18\n\ndelaytt = .0005\ndelayrotor = 0.0005\nttspr = 3200\nrotorspr = 17067\nstartangle = rotorspr/360*startdeflection\ndirpintt = 9  \nsteppintt = 11  \ndirpinrotor = 5\nsteppinrotor = 6\n\nprojectcode =time.strftime(\"20%y-%m-%d %H.%M.%S - \")+projectname+'/'\ndirname='./shared/'+projectcode\nos.makedirs(dirname)  \n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(3, GPIO.OUT)\n\n\ndef ttrun(step_count):\n    GPIO.setup(dirpintt, GPIO.OUT)\n    GPIO.setup(steppintt, GPIO.OUT)\n    if (step_count>0):\n        GPIO.output(dirpintt, GPIO.HIGH)\n    if(step_count<0):\n        GPIO.output(dirpintt, GPIO.LOW)\n        step_count=-step_count\n    for x in range(step_count):\n        GPIO.output(steppintt, GPIO.HIGH)\n        sleep(delaytt)\n        GPIO.output(steppintt, GPIO.LOW)\n        sleep(delaytt)\n\ndef rotorrun(step_count):\n    GPIO.setup(dirpinrotor, GPIO.OUT)\n    GPIO.setup(steppinrotor, GPIO.OUT)\n    if (step_count>0):\n        GPIO.output(dirpinrotor, GPIO.HIGH)\n    if(step_count<0):\n        GPIO.output(dirpinrotor, GPIO.LOW)\n        step_count=-step_count\n    for x in range(step_count):\n        GPIO.output(steppinrotor, GPIO.HIGH)\n        sleep(delayrotor)\n        GPIO.output(steppinrotor, GPIO.LOW)\n        sleep(delayrotor)\n\ndef updatepreview():\n    with open(\"/home/pi/shared/log/updatepreview.log\", \"w\") as file:\n        file.write(time.strftime(\"20%y-%m-%d_%H-%M-%S\"))\n\ndef stoptest():\n    with open(\"/home/pi/shared/log/stopstate.log\", \"r\") as file:\n        if (file.read()!=\"stop\"):\n            return\n    with open(\"/home/pi/shared/log/stopstate.log\", \"w\") as file:\n        file.write(\"--stopping--\")\n    with open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n        file.write(\"--READY--\")\n    shutil.rmtree(dirname)\n    stop()\n\ndef takephoto():\n    stoptest()\n    with picamera.PiCamera() as camera:\n        with open(\"/home/pi/shared/log/cameracontrast.log\", \"r\") as file:\n            cameracontrast=int(file.read())\n        with open(\"/home/pi/shared/log/camerabrightness.log\", \"r\") as file:\n            camerabrightness=int(file.read())\n        camera.iso = 100\n        camera.exposure_mode = 'off'\n        camera.awb_mode = 'off'\n        camera.brightness = camerabrightness\n        camera.contrast = cameracontrast\n        camera.resolution=(resx, resy)\n        camera.exposure_compensation = 0 \n        timestamp= time.strftime(\"20%y-%m-%d_%H-%M-%S\")\n        filepath = dirname+'/'+ timestamp + \".jpg\"\n        camera.capture(filepath, quality=100)\n        \n        #with open(filepath, 'r+b') as file:\n        #    with Image.open(filepath) as image:\n        #        preview2 = image.resize(600,450)\n        #        preview2.save('./shared/preview2.jpg', image.format)\n        sleep(0.5)\n        img = Image.open(filepath)\n        img = img.resize((600, 450))\n        img.save('./shared/ui/preview.jpg')\n        sleep(0.5)\n        pass\n    updatepreview()\n\ndef turntablerotation():\n    for x in range (fotosperrotation):\n        with open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n            file.write(\"Position: \"+str(vertpos)+\"/\"+str(verticalpositions)+\" Foto: \"+str(x+1)+\"/\"+str(fotosperrotation))\n        ttrun(ttspr/fotosperrotation)\n        takephoto()\n\nrotorrun(-startangle)\nfor x in range (verticalpositions-1):\n    vertpos = x+1\n    turntablerotation()\n    if (verticalpositions>1):\n        rotorrun(2*startangle/(verticalpositions-1))\nif (verticalpositions==1):\n    startangle=-startangle\nvertpos=verticalpositions\nturntablerotation()\nrotorrun(-startangle)\n\nwith open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n    file.write(\"creating zip file\")\n\n\nshutil.make_archive('shared/ui/'+projectcode, 'zip', dirname+'/')\nshutil.rmtree(dirname)\n\n\nwith open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n    file.write(\"--READY--\")\nreturn msg","outputs":1,"x":294.0001163482666,"y":1051.0006675720215,"wires":[[]]},{"id":"694110bd.3c57b","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"","group":"69725b10.8f0674","order":10,"width":6,"height":1,"passthru":true,"outs":"all","topic":"","min":"0","max":"100","step":1,"x":651.0000534057617,"y":488.0000228881836,"wires":[["7fd42ecc.25dc3"]]},{"id":"7fd42ecc.25dc3","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/camerabrightness.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":882.0000305175781,"y":488.0000247955322,"wires":[["2feaecea.c7a084"]]},{"id":"ea26c31.600fb4","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"298946ac.30461a","order":6,"width":6,"height":1,"passthru":false,"label":"Reboot","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":84.98044204711914,"y":3325.000382423401,"wires":[["2a781b2e.c77b44","4a55e30f.777f7c"]]},{"id":"6afa2637.adbeb8","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"298946ac.30461a","order":5,"width":6,"height":1,"passthru":false,"label":"Shutdown","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":87.9804458618164,"y":3413.000159263611,"wires":[["e74d7404.bcaee8","4a55e30f.777f7c"]]},{"id":"926375ec.e3b838","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":"","tooltip":"set start deflection angle","group":"18d58d83.c0def2","order":6,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"0","max":"90","step":1,"x":651.0000457763672,"y":440.0000305175781,"wires":[["f4acb943.fb07d8"]]},{"id":"c7383c7f.7aef5","type":"ui_text","z":"77771f03.9ac2f","group":"18d58d83.c0def2","order":5,"width":0,"height":0,"name":"","label":"Start Deflection:","format":"{{msg.payload}}","layout":"row-spread","x":1147.0000457763672,"y":440.0000343322754,"wires":[]},{"id":"f4acb943.fb07d8","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/startdeflection.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":874.0000419616699,"y":440.000036239624,"wires":[["c7383c7f.7aef5"]]},{"id":"7b16f091.89c1c","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"set the number of vertical positions","group":"18d58d83.c0def2","order":4,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"100","step":1,"x":651.0000343322754,"y":391.0000114440918,"wires":[["a031a25f.7726f"]]},{"id":"a031a25f.7726f","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/verticalpositions.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":883.0000305175781,"y":391.00001335144043,"wires":[["fe65564a.866d18"]]},{"id":"fe65564a.866d18","type":"ui_text","z":"77771f03.9ac2f","group":"18d58d83.c0def2","order":3,"width":0,"height":0,"name":"","label":"Vertical Positions:","format":"{{msg.payload}}","layout":"row-spread","x":1158.0000610351562,"y":390.99999809265137,"wires":[]},{"id":"eb9f4a2.cba54b8","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":"","tooltip":" set the number of photos per turntable rotation","group":"18d58d83.c0def2","order":2,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"60","step":1,"x":651.0000343322754,"y":339.0000114440918,"wires":[["d3b8cb70.f45948"]]},{"id":"6565032c.0e4e4c","type":"ui_text","z":"77771f03.9ac2f","group":"18d58d83.c0def2","order":1,"width":0,"height":0,"name":"","label":"Fotos per Rotation:","format":"{{msg.payload}}","layout":"row-spread","x":1158.0000190734863,"y":339.00002098083496,"wires":[]},{"id":"d3b8cb70.f45948","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/fotosperrotation.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":884,"y":339.00002002716064,"wires":[["6565032c.0e4e4c"]]},{"id":"e2c69aa8.534cb8","type":"function","z":"77771f03.9ac2f","name":"Reset Project Name","func":"msg.payload=\"default\"\nreturn msg;","outputs":1,"noerr":0,"x":364.0000457763672,"y":292.0000190734863,"wires":[["8b504d74.d0b8","5c882a6a.e10a84"]]},{"id":"8b504d74.d0b8","type":"ui_text_input","z":"77771f03.9ac2f","name":"","label":"Project Name","tooltip":"enter project name + press enter","group":"18d58d83.c0def2","order":7,"width":6,"height":1,"passthru":true,"mode":"text","delay":"300","topic":"","x":682.0000534057617,"y":291.0000171661377,"wires":[["5c882a6a.e10a84"]]},{"id":"5c882a6a.e10a84","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/projectname.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":928.999885559082,"y":290.0000419616699,"wires":[[]]},{"id":"1107fd8e.aedad2","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"Bluetooth on/off","tooltip":"","group":"1b88f8f5.b7ca47","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":108.0000114440918,"y":1732.0000295639038,"wires":[[]]},{"id":"9bae3fac.a7eed","type":"function","z":"77771f03.9ac2f","name":"timestamp pic file","func":"var d = new Date();\nvar n = d.getTime();\nmsg.payload = \"/ui/preview.jpg?ts=\" + n;\nreturn msg;","outputs":1,"noerr":0,"x":824.5058212280273,"y":905.1087398529053,"wires":[["534debb4.758bd4"]]},{"id":"534debb4.758bd4","type":"ui_template","z":"77771f03.9ac2f","group":"b0cb603d.cba9f","name":"preview","order":1,"width":0,"height":0,"format":"<div height=\"600\" style=\"height: 600px;\" >\n<img ng-src= {{msg.payload}} </img>\n<a src=\"/preview.jpg\" </a>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1017.3211784362793,"y":904.8245515823364,"wires":[[]]},{"id":"2aad71c5.72d5fe","type":"python3-function","z":"77771f03.9ac2f","name":"Take Preview Shot","func":"import time\nimport picamera\nfrom time import sleep\n\nresx=int(3280)\nresy=int(2464)\nwith open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"r\") as file:\n    currentstatus=file.read()\n\nif currentstatus == \"--READY--\":\n    with picamera.PiCamera() as camera:\n        with open(\"/home/pi/shared/log/cameracontrast.log\", \"r\") as file:\n            cameracontrast=int(file.read())\n        with open(\"/home/pi/shared/log/camerabrightness.log\", \"r\") as file:\n            camerabrightness=int(file.read())\n        camera.iso = 100\n        camera.exposure_mode = 'off'\n        camera.awb_mode = 'off'\n        camera.brightness = camerabrightness\n        camera.contrast = cameracontrast\n        camera.resolution=(resx, resy)\n        camera.exposure_compensation = 0 \n        camera.capture(\"./shared/ui/preview.jpg\",quality=100 ,resize=(600,450))\n        pass\n    return msg","outputs":1,"x":594.0001411437988,"y":905.0007381439209,"wires":[["9bae3fac.a7eed"]]},{"id":"39d74681.35e8ca","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/cameracontrast.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":420.01741790771484,"y":535.0104265213013,"wires":[["2c07dc7f.f92ab4"]]},{"id":"2a420a73.4626f6","type":"ui_text","z":"77771f03.9ac2f","group":"69725b10.8f0674","order":11,"width":6,"height":1,"name":"","label":"Camera Contrast","format":"{{msg.payload}}","layout":"row-spread","x":1158.0173377990723,"y":535.010461807251,"wires":[]},{"id":"2c07dc7f.f92ab4","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"","group":"69725b10.8f0674","order":12,"width":6,"height":1,"passthru":true,"outs":"all","topic":"","min":"-100","max":"100","step":"5","x":650.0174179077148,"y":535.0104265213013,"wires":[["205f4a4d.14df86"]]},{"id":"205f4a4d.14df86","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/cameracontrast.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":881.0174179077148,"y":535.010422706604,"wires":[["2a420a73.4626f6"]]},{"id":"58077aa9.67cdf4","type":"comment","z":"77771f03.9ac2f","name":"RPi Camera","info":"","x":102.01958465576172,"y":184.88280773162842,"wires":[]},{"id":"8783a200.2fd6a","type":"comment","z":"77771f03.9ac2f","name":"Bluetooth","info":"","x":87.01956176757812,"y":1680.00399684906,"wires":[]},{"id":"c3046a39.3eb8a8","type":"comment","z":"77771f03.9ac2f","name":"External Camera","info":"","x":98.01956176757812,"y":2261.003969192505,"wires":[]},{"id":"5bf67a3f.873094","type":"comment","z":"77771f03.9ac2f","name":"System","info":"","x":55,"y":3274.0040607452393,"wires":[]},{"id":"8a4b0425.e86588","type":"ui_button","z":"77771f03.9ac2f","name":"Delete old files","group":"298946ac.30461a","order":8,"width":6,"height":1,"passthru":false,"label":"Delete all files","tooltip":"This can not be undone","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":106,"y":3469.0041608810425,"wires":[["f23b4447.1a69f8"]]},{"id":"f23b4447.1a69f8","type":"exec","z":"77771f03.9ac2f","command":"sudo rm -rf -d /home/pi/shared/ui/*.zip && sudo rm -rf  /home/pi/shared/2019*/","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":485.98828887939453,"y":3469.2421875,"wires":[[],[],[]]},{"id":"a05a87b0.b59d18","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"1b88f8f5.b7ca47","order":6,"width":2,"height":1,"passthru":false,"label":"⇐","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":79.01957321166992,"y":1827.0040578842163,"wires":[["5cbfaf70.449a6"]]},{"id":"12e6a881.fb9e27","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"1b88f8f5.b7ca47","order":7,"width":2,"height":1,"passthru":false,"label":"⇒","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":79.01957321166992,"y":1867.0040578842163,"wires":[["30492049.0bf7b"]]},{"id":"a86a4036.04027","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"1b88f8f5.b7ca47","order":3,"width":2,"height":1,"passthru":false,"label":"⇑","tooltip":"","color":"","bgcolor":"","icon":"","payload":"500","payloadType":"num","topic":"","x":419.0195732116699,"y":1827.0040578842163,"wires":[["688f0409.8aebac"]]},{"id":"51957fd6.e1fe9","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"1b88f8f5.b7ca47","order":4,"width":2,"height":1,"passthru":false,"label":"⇓","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":419.0195732116699,"y":1867.0040578842163,"wires":[["a2d2fbf4.871498"]]},{"id":"a387d2b5.4d9ba","type":"ui_text","z":"77771f03.9ac2f","group":"1b88f8f5.b7ca47","order":5,"width":4,"height":1,"name":"","label":"Turntable","format":"{{\"\"}}","layout":"row-center","x":89.01957321166992,"y":1787.0040578842163,"wires":[]},{"id":"48e8a576.abf9bc","type":"ui_text","z":"77771f03.9ac2f","group":"1b88f8f5.b7ca47","order":2,"width":4,"height":1,"name":"","label":"Rotor","format":"{{\"\"}}","layout":"row-center","x":419.0195732116699,"y":1787.0040578842163,"wires":[]},{"id":"5cbfaf70.449a6","type":"python3-function","z":"77771f03.9ac2f","name":"TT left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 14   # Direction GPIO Pin\nSTEP = 15  # Step GPIO Pin\nCW = 1     # Clockwise Rotation\nCCW = 0    # Counterclockwise Rotation\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, CW)\n\n\nstep_count = SPR\n#delay = .0208\ndelay = .0005\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\n\n\nGPIO.cleanup()","outputs":1,"x":219.01957321166992,"y":1827.0040578842163,"wires":[[]]},{"id":"30492049.0bf7b","type":"python3-function","z":"77771f03.9ac2f","name":"TT right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\n\nDIR = 14   # Direction GPIO Pin\nSTEP = 15  # Step GPIO Pin\nCW = 1     # Clockwise Rotation\nCCW = 0    # Counterclockwise Rotation\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, CW)\n\nstep_count = SPR\n#delay = .0208\ndelay = .0005\n\nGPIO.output(DIR, CCW)\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\nGPIO.cleanup()\n","outputs":1,"x":229.01957321166992,"y":1867.0040578842163,"wires":[[]]},{"id":"688f0409.8aebac","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 8   # Direction GPIO Pin\nSTEP = 7  # Step GPIO Pin\nCW = 1     # Clockwise Rotation\nCCW = 0    # Counterclockwise Rotation\nSPR = 200   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, CW)\n\nstep_count = SPR\ndelay = .0005\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n","outputs":1,"x":569.0195732116699,"y":1827.0040578842163,"wires":[[]]},{"id":"a2d2fbf4.871498","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 8   # Direction GPIO Pin\nSTEP = 7  # Step GPIO Pin\nCW = 1     # Clockwise Rotation\nCCW = 0    # Counterclockwise Rotation\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, CW)\n\nstep_count = SPR\n#delay = .0208\ndelay = .0005\n\nGPIO.output(DIR, CCW)\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n","outputs":1,"x":579.0195732116699,"y":1867.0040578842163,"wires":[[]]},{"id":"16d5b5b9.f988ca","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"b02275fc.c7e658","order":5,"width":2,"height":1,"passthru":false,"label":"⇐","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":84.01956176757812,"y":2338.0039138793945,"wires":[["40ffec4e.9b10b4"]]},{"id":"edf26cb3.fcff8","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"b02275fc.c7e658","order":6,"width":2,"height":1,"passthru":false,"label":"⇒","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":84.01956176757812,"y":2378.0039138793945,"wires":[["e28265a2.c71e18"]]},{"id":"f610161a.795558","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"b02275fc.c7e658","order":2,"width":2,"height":1,"passthru":false,"label":"⇑","tooltip":"","color":"","bgcolor":"","icon":"","payload":"500","payloadType":"num","topic":"","x":424.0195617675781,"y":2338.0039138793945,"wires":[["a1c4b607.d11918"]]},{"id":"4ff666a8.d82d28","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"b02275fc.c7e658","order":3,"width":2,"height":1,"passthru":false,"label":"⇓","tooltip":"","color":"","bgcolor":"","icon":"","payload":"200","payloadType":"num","topic":"","x":424.0195617675781,"y":2378.0039138793945,"wires":[["bafa91f3.bdcd2"]]},{"id":"1538975a.a83d79","type":"ui_text","z":"77771f03.9ac2f","group":"b02275fc.c7e658","order":4,"width":2,"height":1,"name":"","label":"Turntable","format":"{{\"\"}}","layout":"row-center","x":94.01956176757812,"y":2298.0039138793945,"wires":[]},{"id":"73294054.5c104","type":"ui_text","z":"77771f03.9ac2f","group":"b02275fc.c7e658","order":1,"width":2,"height":1,"name":"","label":"Rotor","format":"{{\"\"}}","layout":"row-center","x":424.0195617675781,"y":2298.0039138793945,"wires":[]},{"id":"40ffec4e.9b10b4","type":"python3-function","z":"77771f03.9ac2f","name":"TT left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 9   # Direction GPIO Pin\nSTEP = 11  # Step GPIO Pin\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 0)\n\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\n\n\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":226.01740646362305,"y":2337.6774764060974,"wires":[[]]},{"id":"e28265a2.c71e18","type":"python3-function","z":"77771f03.9ac2f","name":"TT right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\n\nDIR = 9   # Direction GPIO Pin\nSTEP = 11  # Step GPIO Pin\n\nSPR = msg['payload']   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 1)\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\n\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":240.01739501953125,"y":2377.6775431632996,"wires":[[]]},{"id":"a1c4b607.d11918","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor left","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 5   # Direction GPIO Pin\nSTEP = 6  # Step GPIO Pin\nSPR = 200   # Steps per Revolution (360 / 7.5)\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 0)\n\nstep_count = SPR\ndelay = .0005\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":622.017391204834,"y":2338.6774549484253,"wires":[[]]},{"id":"bafa91f3.bdcd2","type":"python3-function","z":"77771f03.9ac2f","name":"Rotor right","func":"from time import sleep\nimport RPi.GPIO as GPIO\nGPIO.setwarnings(False)\n\nDIR = 5   # Direction GPIO Pin\nSTEP = 6  # Step GPIO Pin\nSPR = 200\n\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(DIR, GPIO.OUT)\nGPIO.setup(STEP, GPIO.OUT)\nGPIO.output(DIR, 1)\n\nstep_count = SPR\ndelay = .0005\n\nfor x in range(step_count):\n    GPIO.output(STEP, GPIO.HIGH)\n    sleep(delay)\n    GPIO.output(STEP, GPIO.LOW)\n    sleep(delay)\nGPIO.cleanup()\n\nreturn msg","outputs":1,"x":632.017391204834,"y":2378.6774549484253,"wires":[[]]},{"id":"b1ae421.3e81dc","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/fotosperrotation_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":370.0173091888428,"y":2467.010503768921,"wires":[["eac73566.c16a48"]]},{"id":"831b9466.7456e8","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/verticalpositions_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":371.017333984375,"y":2515.010322570801,"wires":[["f36ac630.b72b18"]]},{"id":"d01768b0.5ca238","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/startdeflection_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":360.0173149108887,"y":2563.010407447815,"wires":[["dcb93a5e.7d87d8"]]},{"id":"dcb93a5e.7d87d8","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":"","tooltip":"set start deflection angle","group":"827e393f.87fff8","order":6,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"0","max":"90","step":1,"x":615.0173072814941,"y":2563.010326385498,"wires":[["6e04d86f.9fdb18"]]},{"id":"853b2129.5a62a","type":"ui_text","z":"77771f03.9ac2f","group":"827e393f.87fff8","order":5,"width":0,"height":0,"name":"","label":"Start Deflection:","format":"{{msg.payload}}","layout":"row-spread","x":1134.0172500610352,"y":2563.0102405548096,"wires":[]},{"id":"6e04d86f.9fdb18","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/startdeflection_ext.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":851.0173034667969,"y":2563.010513305664,"wires":[["853b2129.5a62a"]]},{"id":"f36ac630.b72b18","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"set the number of vertical positions","group":"827e393f.87fff8","order":4,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"10","step":1,"x":615.0173072814941,"y":2515.010322570801,"wires":[["9b8d580e.2a8458"]]},{"id":"9b8d580e.2a8458","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/verticalpositions_ext.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":861.0173034667969,"y":2515.010509490967,"wires":[["c21c5956.35ca18"]]},{"id":"c21c5956.35ca18","type":"ui_text","z":"77771f03.9ac2f","group":"827e393f.87fff8","order":3,"width":0,"height":0,"name":"","label":"Vertical Positions:","format":"{{msg.payload}}","layout":"row-spread","x":1144.017276763916,"y":2515.010398864746,"wires":[]},{"id":"eac73566.c16a48","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":"","tooltip":" set the number of photos per turntable rotation","group":"827e393f.87fff8","order":2,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"60","step":1,"x":615.0173206329346,"y":2467.0104973316193,"wires":[["fdc2aa59.97f478"]]},{"id":"3bcf2c26.ecd954","type":"ui_text","z":"77771f03.9ac2f","group":"827e393f.87fff8","order":1,"width":0,"height":0,"name":"","label":"Fotos per Rotation:","format":"{{msg.payload}}","layout":"row-spread","x":1144.017339706421,"y":2467.010267496109,"wires":[]},{"id":"fdc2aa59.97f478","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/fotosperrotation_ext.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":862.0173091888428,"y":2467.010595560074,"wires":[["3bcf2c26.ecd954"]]},{"id":"efbbae53.7cda7","type":"inject","z":"77771f03.9ac2f","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"","x":85.00003051757812,"y":2466.6667556762695,"wires":[["b1ae421.3e81dc","831b9466.7456e8","d01768b0.5ca238","e980e50d.b92ef8","aa097fe6.76d35","4c6f45bf.d0661c"]]},{"id":"80ea2b25.a56228","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/timeperfoto_ext.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":852.0000495910645,"y":2610.6667137145996,"wires":[["4ba681ae.1f019"]]},{"id":"e980e50d.b92ef8","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/timeperfoto_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":358.0000305175781,"y":2610.6667976379395,"wires":[["74937e3c.7e75b"]]},{"id":"74937e3c.7e75b","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"","group":"a8c1005f.7b3e6","order":2,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"0.5","max":"3","step":"0.1","x":616.0000228881836,"y":2610.6667461395264,"wires":[["80ea2b25.a56228"]]},{"id":"4ba681ae.1f019","type":"ui_text","z":"77771f03.9ac2f","group":"a8c1005f.7b3e6","order":1,"width":0,"height":0,"name":"","label":"Time per Foto (s)","format":"{{msg.payload}}","layout":"row-spread","x":1144.0000801086426,"y":2610.6668701171875,"wires":[]},{"id":"b36d6718.fda098","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"a8c1005f.7b3e6","order":6,"width":0,"height":0,"passthru":false,"label":"Start Routine","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":93.01738357543945,"y":2815.5662183761597,"wires":[["7eb9fce0.082b14"]]},{"id":"ea745a25.950d58","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/releasetime_ext.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":850.0000648498535,"y":2657.5658054351807,"wires":[["14f2bcb6.10b763"]]},{"id":"aa097fe6.76d35","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/releasetime_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":359.00004959106445,"y":2657.5658588409424,"wires":[["e4693148.44"]]},{"id":"e4693148.44","type":"ui_slider","z":"77771f03.9ac2f","name":"","label":" ","tooltip":"","group":"a8c1005f.7b3e6","order":4,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"10","max":"200","step":"10","x":616.0000419616699,"y":2657.5658073425293,"wires":[["ea745a25.950d58"]]},{"id":"14f2bcb6.10b763","type":"ui_text","z":"77771f03.9ac2f","group":"a8c1005f.7b3e6","order":3,"width":0,"height":0,"name":"","label":"Release time (ms)","format":"{{msg.payload}}","layout":"row-spread","x":1142.0000495910645,"y":2657.5658168792725,"wires":[]},{"id":"9ee0aedd.57d62","type":"inject","z":"77771f03.9ac2f","name":"","topic":"Repeater","payload":"0.1","payloadType":"str","repeat":"0.1","crontab":"","once":true,"onceDelay":"5","x":101.01741790771484,"y":2760.78897857666,"wires":[["11f09d38.b3a443"]]},{"id":"11f09d38.b3a443","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/currentstatus_ext.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":515.0173492431641,"y":2759.7883825302124,"wires":[["dac6f06.6a8a51"]]},{"id":"dac6f06.6a8a51","type":"ui_text","z":"77771f03.9ac2f","group":"a8c1005f.7b3e6","order":8,"width":0,"height":0,"name":"","label":"Current Status:","format":"{{msg.payload}}","layout":"row-spread","x":816.0173492431641,"y":2759.7886209487915,"wires":[]},{"id":"9f8de708.02a848","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/ssh.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":762.9804649353027,"y":3526.9999237060547,"wires":[[]]},{"id":"fe88b0d9.545b2","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/ssh.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":334.98046493530273,"y":3527.9999237060547,"wires":[["db090374.3dbf2"]]},{"id":"db090374.3dbf2","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"SSH Off/On","tooltip":"","group":"298946ac.30461a","order":2,"width":6,"height":1,"passthru":false,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":542.9804649353027,"y":3526.9999237060547,"wires":[["9f8de708.02a848","eee9c638.6c12a8"]]},{"id":"29cdc219.6ef8be","type":"exec","z":"77771f03.9ac2f","command":"sudo /etc/init.d/ssh stop ","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":999.9804725646973,"y":3609.9999256134033,"wires":[[],[],[]]},{"id":"eee9c638.6c12a8","type":"function","z":"77771f03.9ac2f","name":"Load Variables","func":"if (msg.payload === true){\n    return [msg,null]\n}\nif (msg.payload ===false){\n    return [null,msg]\n}","outputs":2,"noerr":0,"x":723.9804420471191,"y":3564.999979019165,"wires":[["f6ef2063.9fa0b"],["29cdc219.6ef8be"]]},{"id":"f6ef2063.9fa0b","type":"exec","z":"77771f03.9ac2f","command":"sudo /etc/init.d/ssh start","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":999.9804878234863,"y":3557.999921798706,"wires":[[],[],[]]},{"id":"67fbaf00.928d8","type":"inject","z":"77771f03.9ac2f","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"","x":84.98046493530273,"y":3527.9999237060547,"wires":[["fe88b0d9.545b2","9de3bd8a.aab4c","8ccdc990.44aa18"]]},{"id":"3f3c735d.122e2c","type":"file","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/samba.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":820.9804954528809,"y":3688.12154006958,"wires":[[]]},{"id":"9de3bd8a.aab4c","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/samba.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":336.9804496765137,"y":3688.121431350708,"wires":[["ebcc3692.3b85d8"]]},{"id":"ebcc3692.3b85d8","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"Samba Off/On","tooltip":"","group":"298946ac.30461a","order":1,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":572.9804344177246,"y":3688.1215057373047,"wires":[["3f3c735d.122e2c","c4311c4d.0b58f"]]},{"id":"99a9f00.60c2f1","type":"exec","z":"77771f03.9ac2f","command":"sudo /etc/init.d/smbd stop","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1063.9804725646973,"y":3773.12162399292,"wires":[[],[],[]]},{"id":"c4311c4d.0b58f","type":"function","z":"77771f03.9ac2f","name":"Load Variables","func":"if (msg.payload === true){\n    return [msg,null]\n}\nreturn [null,msg]\n","outputs":2,"noerr":0,"x":775.9804878234863,"y":3727.121406555176,"wires":[["28eeb9cb.61cc76"],["99a9f00.60c2f1"]]},{"id":"28eeb9cb.61cc76","type":"exec","z":"77771f03.9ac2f","command":"sudo /etc/init.d/smbd start","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1064.9804725646973,"y":3721.1214599609375,"wires":[[],[],[]]},{"id":"b9fde4aa.8a70a8","type":"inject","z":"77771f03.9ac2f","name":"","topic":"Repeater","payload":"1","payloadType":"str","repeat":"0.1","crontab":"","once":true,"onceDelay":"5","x":104.01738357543945,"y":1417.232708454132,"wires":[["f529b66.d859448"]]},{"id":"b5423248.ed0ce","type":"ui_template","z":"77771f03.9ac2f","group":"d1b34e46.16c73","name":"Display File List","order":1,"width":6,"height":10,"format":"<script>\n \nthis.scope.action = function(opt) {\n var playFile = opt || \"no data passed to function\";\n// console.warn(playFile)\n return playFile; } \n</script>\n\n\n<div style=\"max-width:500px;\">\n <ul>\n <li ng-repeat=\"file in msg.files track by $index\" style=\"list-style-type: none;\">\n <label>\n <input type=\"radio\" ng-model=\"$parent.file\" name=\"data\" value=\"{{file}}\" required />{{file}}\n </label>\n </li>\n </ul>\n\n<md-button  style=\"width:100%; height:53px;\"  target=\"_blank\" ng-href=\"/ui/{{file}}\">\n <div class=\"center\" style=\"position: relative;\n    top: 30%;\">\n  Download File\n</div></md-button>\n\n</div>\n\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":464.0174217224121,"y":1487.5660605430603,"wires":[["8e32209.b1020e"]]},{"id":"8e32209.b1020e","type":"fs-ops-dir","z":"77771f03.9ac2f","name":"/media/pi/","path":"path","pathType":"msg","filter":"*","filterType":"str","dir":"files","dirType":"msg","x":457.01731872558594,"y":1417.5662741661072,"wires":[["b5423248.ed0ce"]]},{"id":"f529b66.d859448","type":"function","z":"77771f03.9ac2f","name":"","func":"msg.path = \"shared/ui\"\n\nreturn msg;","outputs":1,"noerr":0,"x":276.0173149108887,"y":1417.5662741661072,"wires":[["8e32209.b1020e"]]},{"id":"97f02320.eb43","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"Ringlight  (2)","tooltip":"","group":"69725b10.8f0674","order":15,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":482.0034408569336,"y":1351.9000267982483,"wires":[["c75b814b.6a9a"]]},{"id":"bed1304d.28b7c","type":"python3-function","z":"77771f03.9ac2f","name":"Ringlight on/off","func":"from time import sleep\nimport RPi.GPIO as GPIO\n\nringlightpin = 27\n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(ringlightpin, GPIO.OUT)\n\nwith open(\"/home/pi/shared/log/ringlightstatus2.log\", \"r\") as file:\n    state=file.read()\n\n\nif state == \"on\":\n    GPIO.output(ringlightpin, GPIO.HIGH)\nif state == \"off\":\n    GPIO.output(ringlightpin, GPIO.LOW)\n\nmsg['payload']=state\n\nreturn msg","outputs":1,"x":299.9999694824219,"y":1351.3090167045593,"wires":[["97f02320.eb43"]]},{"id":"5bcdc8e6.7dd098","type":"python3-function","z":"77771f03.9ac2f","name":"blink + update preview","func":"from time import sleep\nimport RPi.GPIO as GPIO\n\nringlightpin = 17\nsleeptime = 0.05\n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(ringlightpin, GPIO.OUT)\n\nfor x in range(20):\n    GPIO.output(ringlightpin, GPIO.HIGH)\n    sleep(sleeptime)\n    GPIO.output(ringlightpin, GPIO.LOW)\n    sleep(sleeptime)\n\nreturn msg","outputs":1,"x":359.0174026489258,"y":579.1216220855713,"wires":[["aa223a6.07ef2c8"]]},{"id":"e74d7404.bcaee8","type":"delay","z":"77771f03.9ac2f","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":295.9978370666504,"y":3412.89936542511,"wires":[["c98a7d7e.19ebf"]]},{"id":"2a781b2e.c77b44","type":"delay","z":"77771f03.9ac2f","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":296.9944152832031,"y":3324.8090209960938,"wires":[["d75ddc63.2a31e"]]},{"id":"4a55e30f.777f7c","type":"python3-function","z":"77771f03.9ac2f","name":"blink","func":"from time import sleep\nimport RPi.GPIO as GPIO\n\nringlightpin = 17\nsleeptime = 0.05\n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(ringlightpin, GPIO.OUT)\n\nwith open(\"/home/pi/shared/log/ringlightstatus1.log\", \"w\") as file:\n    file.write(\"off\")\nwith open(\"/home/pi/shared/log/ringlightstatus2.log\", \"w\") as file:\n    file.write(\"off\")\n\nfor x in range(10):\n    GPIO.output(ringlightpin, GPIO.HIGH)\n    sleep(sleeptime)\n    GPIO.output(ringlightpin, GPIO.LOW)\n    sleep(sleeptime)\n","outputs":1,"x":266.99790954589844,"y":3367.011058807373,"wires":[[]]},{"id":"2a18ae95.40b4b2","type":"function","z":"77771f03.9ac2f","name":"Autoupdate on?","func":"if (global.get(\"autoupdate\") == \"on\"){\n    return msg\n}","outputs":1,"noerr":0,"x":342.00012969970703,"y":729.0001840591431,"wires":[["409865cb.4efdcc"]]},{"id":"826e49c4.c3fa98","type":"delay","z":"77771f03.9ac2f","name":"","pauseType":"rate","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1.2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":346.9999885559082,"y":906.0010328292847,"wires":[["2aad71c5.72d5fe"]]},{"id":"8ce8fa49.afa908","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"Auto Update Preview","tooltip":"","group":"298946ac.30461a","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":515.9804649353027,"y":3834.9999237060547,"wires":[["c7cdad92.ce654"]]},{"id":"c7cdad92.ce654","type":"change","z":"77771f03.9ac2f","name":"","rules":[{"t":"set","p":"autoupdate","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":748.9804649353027,"y":3835.9999237060547,"wires":[[]]},{"id":"8ccdc990.44aa18","type":"function","z":"77771f03.9ac2f","name":"turn autoupdate off","func":"msg.payload=\"off\"\nreturn msg","outputs":1,"noerr":0,"x":291.98046493530273,"y":3834.9999237060547,"wires":[["8ce8fa49.afa908"]]},{"id":"8214b592.a7d398","type":"exec","z":"77771f03.9ac2f","command":"sudo rm -rf -d /home/pi/shared/ui/preview.jpg","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":432.0000686645508,"y":246.50003242492676,"wires":[[],[],[]]},{"id":"2abef649.a45b3a","type":"ui_switch","z":"77771f03.9ac2f","name":"","label":"Ringlight (1)","tooltip":"","group":"69725b10.8f0674","order":14,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":479.0207862854004,"y":1305.4912114143372,"wires":[["68616952.2397a8"]]},{"id":"3c6f112a.4d9e3e","type":"inject","z":"77771f03.9ac2f","name":"","topic":"Repeater","payload":"0.1","payloadType":"str","repeat":"0.1","crontab":"","once":true,"onceDelay":"3","x":103.01734161376953,"y":1304.7890038490295,"wires":[["8e4c43d.616bac","bed1304d.28b7c"]]},{"id":"8e4c43d.616bac","type":"python3-function","z":"77771f03.9ac2f","name":"Ringlight on/off","func":"from time import sleep\nimport RPi.GPIO as GPIO\nringlightpin = 17\n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(ringlightpin, GPIO.OUT)\n\nwith open(\"/home/pi/shared/log/ringlightstatus1.log\", \"r\") as file:\n    state=file.read()\n\n\nif state == \"on\":\n    GPIO.output(ringlightpin, GPIO.HIGH)\nif state == \"off\":\n    GPIO.output(ringlightpin, GPIO.LOW)\n\nmsg['payload']=state\n\nreturn msg","outputs":1,"x":297.0173149108887,"y":1304.9002013206482,"wires":[["2abef649.a45b3a"]]},{"id":"d28fadcc.36358","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/currentstatus_rpi.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":422.00001525878906,"y":771.9999723434448,"wires":[["41087bd.f2f6084"]]},{"id":"41087bd.f2f6084","type":"ui_text","z":"77771f03.9ac2f","group":"18d58d83.c0def2","order":10,"width":0,"height":0,"name":"","label":"Current Status:","format":"{{msg.payload}}","layout":"row-spread","x":691.9999752044678,"y":772.000226020813,"wires":[]},{"id":"10d33f8d.882a2","type":"inject","z":"77771f03.9ac2f","name":"","topic":"Repeater","payload":"0.5","payloadType":"str","repeat":"0.5","crontab":"","once":true,"onceDelay":"1","x":111.0000228881836,"y":729.0006237030029,"wires":[["d28fadcc.36358","2a18ae95.40b4b2","89333d3c.57eb9"]]},{"id":"89333d3c.57eb9","type":"file in","z":"77771f03.9ac2f","name":"","filename":"/home/pi/shared/log/updatepreview.log","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":411.01734161376953,"y":817.4552965164185,"wires":[["34c4c15b.1459ae"]]},{"id":"34c4c15b.1459ae","type":"function","z":"77771f03.9ac2f","name":"check preview mod","func":"if (msg.payload!=global.get(\"updatepreview\")){\n    return msg\n}\n","outputs":1,"noerr":0,"x":683.017333984375,"y":817.5661773681641,"wires":[["9bae3fac.a7eed","61d0a9d9.962ea8"]]},{"id":"22645f40.0596f","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"18d58d83.c0def2","order":9,"width":0,"height":0,"passthru":true,"label":"Stop Routine","tooltip":"","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":99.01734924316406,"y":1004.7886657714844,"wires":[["bf8789d.1186278"]]},{"id":"87bba322.aeb09","type":"link in","z":"77771f03.9ac2f","name":"Update Preview","links":["31d8912f.272b4e","6a935848.afa4d8","1ff265b8.a969fa","7c3dc728.5faa18","443b220.ef9a7e","409865cb.4efdcc","85914e85.e0468","e7d13a45.c91618","aa223a6.07ef2c8","8653681e.860d78"],"x":167.02441596984863,"y":947.7504224777222,"wires":[["826e49c4.c3fa98"]]},{"id":"409865cb.4efdcc","type":"link out","z":"77771f03.9ac2f","name":"","links":["87bba322.aeb09"],"x":475.0174684524536,"y":728.6773767471313,"wires":[]},{"id":"85914e85.e0468","type":"link out","z":"77771f03.9ac2f","name":"","links":["87bba322.aeb09"],"x":728.017391204834,"y":1222.6772508621216,"wires":[]},{"id":"e7d13a45.c91618","type":"link out","z":"77771f03.9ac2f","name":"","links":["87bba322.aeb09"],"x":367.01740646362305,"y":1226.6772012710571,"wires":[]},{"id":"aa223a6.07ef2c8","type":"link out","z":"77771f03.9ac2f","name":"","links":["87bba322.aeb09"],"x":497.01742362976074,"y":579.5663318634033,"wires":[]},{"id":"68616952.2397a8","type":"python3-function","z":"77771f03.9ac2f","name":"Ringlight on/off","func":"\nwith open(\"/home/pi/shared/log/ringlightstatus1.log\", \"r\") as file:\n    oldstate=file.read()\nnewstate =msg['payload']\n\nif newstate!=oldstate:\n    with open(\"/home/pi/shared/log/ringlightstatus1.log\", \"w\") as file:\n        file.write(newstate)\n    return msg\n","outputs":1,"x":676.0173530578613,"y":1305.2330346107483,"wires":[["8653681e.860d78"]]},{"id":"c75b814b.6a9a","type":"python3-function","z":"77771f03.9ac2f","name":"Ringlight on/off","func":"\nwith open(\"/home/pi/shared/log/ringlightstatus2.log\", \"r\") as file:\n    oldstate=file.read()\nnewstate =msg['payload']\n\nif newstate!=oldstate:\n    with open(\"/home/pi/shared/log/ringlightstatus2.log\", \"w\") as file:\n        file.write(newstate)\n    return msg\n","outputs":1,"x":674.017391204834,"y":1352.3439726829529,"wires":[["8653681e.860d78"]]},{"id":"82ad645b.ad0a68","type":"python3-function","z":"77771f03.9ac2f","name":"set initial variables","func":"with open(\"/home/pi/shared/log/stopstate.log\", \"w\") as file:\n    file.write(\"run\")\nwith open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n    file.write(\"--READY--\")\nwith open(\"/home/pi/shared/log/updatepreview.log\", \"w\") as file:\n    file.write(\"start\")\nwith open(\"/home/pi/shared/log/ringlightstatus1.log\", \"w\") as file:\n    file.write(\"off\")\nwith open(\"/home/pi/shared/log/ringlightstatus2.log\", \"w\") as file:\n    file.write(\"off\")\n","outputs":1,"x":344.01399993896484,"y":628.1320133209229,"wires":[[]]},{"id":"bf8789d.1186278","type":"python3-function","z":"77771f03.9ac2f","name":"set stop state variables","func":"with open(\"/home/pi/shared/log/stopstate.log\", \"w\") as file:\n    file.write(\"stop\")\nwith open(\"/home/pi/shared/log/currentstatus_rpi.log\", \"w\") as file:\n    file.write(\"--stopping--\")","outputs":1,"x":321.0174026489258,"y":1004.899384021759,"wires":[[]]},{"id":"8653681e.860d78","type":"link out","z":"77771f03.9ac2f","name":"","links":["87bba322.aeb09"],"x":805.0173645019531,"y":1332.0105519294739,"wires":[]},{"id":"61d0a9d9.962ea8","type":"change","z":"77771f03.9ac2f","name":"","rules":[{"t":"set","p":"updatepreview","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":953.0139236450195,"y":818.2466592788696,"wires":[[]]},{"id":"70aa2f2e.e2903","type":"comment","z":"77771f03.9ac2f","name":"--------------------------------- TO DO ---------------------------------","info":"camera orientation\nstop code in run routine (replace error :)\nreplace global variable in external camera \ncheck external camera\n\nbluetooth functionality","x":667.0173492431641,"y":82.01042747497559,"wires":[]},{"id":"7eb9fce0.082b14","type":"python3-function","z":"77771f03.9ac2f","name":"Run Routine","func":"import RPi.GPIO as GPIO\nimport time\nimport picamera\nfrom time import sleep\n\n#recieve global variables\nwith open(\"/home/pi/shared/log/fotosperrotation_ext.log\", \"r\") as file:\n    fotosperrotation=int(file.read())\nwith open(\"/home/pi/shared/log/startdeflection_ext.log\", \"r\") as file:\n    startdeflection=int(file.read())\nwith open(\"/home/pi/shared/log/verticalpositions_ext.log\", \"r\") as file:\n    verticalpositions=int(file.read())\nwith open(\"/home/pi/shared/log/releasetime_ext.log\", \"r\") as file:\n    releasetime_ext=int(file.read())\nwith open(\"/home/pi/shared/log/timeperfoto_ext.log\", \"r\") as file:\n    timeperfoto_ext=float(file.read())\n\n\n#set some fixed parameters\ncamerawidth= 1\ncameraheight= 1\nresx=int(3280)\nresy=int(2464)\nphotopin=10\n\ndelaytt = .0005\ndelayrotor = 0.0005\nttspr = 3200\nrotorspr = 17067\nstartangle = rotorspr/360*startdeflection\ndirpintt = 9  \nsteppintt = 11  \ndirpinrotor = 5\nsteppinrotor = 6\n\nGPIO.setwarnings(False)\nGPIO.setmode(GPIO.BCM)\nGPIO.setup(3, GPIO.OUT)\n\n\ndef ttrun(step_count):\n    GPIO.setup(dirpintt, GPIO.OUT)\n    GPIO.setup(steppintt, GPIO.OUT)\n    if (step_count>0):\n        GPIO.output(dirpintt, GPIO.HIGH)\n    if(step_count<0):\n        GPIO.output(dirpintt, GPIO.LOW)\n        step_count=-step_count\n    for x in range(step_count):\n        GPIO.output(steppintt, GPIO.HIGH)\n        sleep(delaytt)\n        GPIO.output(steppintt, GPIO.LOW)\n        sleep(delaytt)\n\ndef rotorrun(step_count):\n    GPIO.setup(dirpinrotor, GPIO.OUT)\n    GPIO.setup(steppinrotor, GPIO.OUT)\n    if (step_count>0):\n        GPIO.output(dirpinrotor, GPIO.HIGH)\n    if(step_count<0):\n        GPIO.output(dirpinrotor, GPIO.LOW)\n        step_count=-step_count\n    for x in range(step_count):\n        GPIO.output(steppinrotor, GPIO.HIGH)\n        sleep(delayrotor)\n        GPIO.output(steppinrotor, GPIO.LOW)\n        sleep(delayrotor)\n\ndef stoptest():\n    with open(\"/home/pi/shared/log/stopstate_ext.log\", \"r\") as file:\n        if (file.read()!=\"stop\"):\n            return\n    with open(\"/home/pi/shared/log/stopstate_ext.log\", \"w\") as file:\n        file.write(\"--stopping--\")\n    with open(\"/home/pi/shared/log/currentstatus_ext.log\", \"w\") as file:\n        file.write(\"--READY--\")\n    stop()\n\ndef takephoto():\n    stoptest()\n    GPIO.setup(photopin, GPIO.OUT)\n    GPIO.output(photopin, GPIO.HIGH)\n    sleep(releasetime_ext*0.001)\n    GPIO.output(photopin, GPIO.LOW)\n    sleep(timeperfoto_ext)\n    stoptest()\n\ndef turntablerotation():\n    for x in range (fotosperrotation):\n        with open(\"/home/pi/shared/log/currentstatus_ext.log\", \"w\") as file:\n            file.write(\"Position: \"+str(vertpos)+\"/\"+str(verticalpositions)+\" Foto: \"+str(x+1)+\"/\"+str(fotosperrotation))\n        ttrun(ttspr/fotosperrotation)\n        takephoto()\n\nrotorrun(-startangle)\nfor x in range (verticalpositions-1):\n    vertpos = x+1\n    turntablerotation()\n    if (verticalpositions>1):\n        rotorrun(2*startangle/(verticalpositions-1))\nif (verticalpositions==1):\n    startangle=-startangle\nvertpos=verticalpositions\nturntablerotation()\nrotorrun(-startangle)\n\nwith open(\"/home/pi/shared/log/currentstatus_ext.log\", \"w\") as file:\n    file.write(\"--READY--\")\nreturn msg","outputs":1,"x":285.017333984375,"y":2816.3438262939453,"wires":[[]]},{"id":"9ebc3d21.c1174","type":"ui_button","z":"77771f03.9ac2f","name":"","group":"a8c1005f.7b3e6","order":7,"width":0,"height":0,"passthru":true,"label":"Stop Routine","tooltip":"","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":92.0173568725586,"y":2867.67724609375,"wires":[["d5d5bdb.a476a4"]]},{"id":"d5d5bdb.a476a4","type":"python3-function","z":"77771f03.9ac2f","name":"set stop state variables","func":"with open(\"/home/pi/shared/log/stopstate_ext.log\", \"w\") as file:\n    file.write(\"stop\")\nwith open(\"/home/pi/shared/log/currentstatus_ext.log\", \"w\") as file:\n    file.write(\"--stopping--\")","outputs":1,"x":314.0174102783203,"y":2867.7879643440247,"wires":[[]]},{"id":"4c6f45bf.d0661c","type":"python3-function","z":"77771f03.9ac2f","name":"set initial variables","func":"with open(\"/home/pi/shared/log/stopstate_ext.log\", \"w\") as file:\n    file.write(\"run\")\nwith open(\"/home/pi/shared/log/currentstatus_ext.log\", \"w\") as file:\n    file.write(\"--READY--\")\n","outputs":1,"x":288.01734161376953,"y":2700.3436698913574,"wires":[[]]}]
